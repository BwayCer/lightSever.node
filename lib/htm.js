/*! HyperText Manager (PureText) @license: CC-BY-4.0 - BwayCer (https://bwaycer.github.io/about/) */
var log = require( './log' );
module.exports=function(){log.setMsg({htm_canNotCreateEltTag:"Can't create element tag.",htm_canNotPositioning:"Can't mark positioning point.",htm_doubleCall:'"%s" function is called double.'});var z=function(){for(var f=0,l=arguments.length-1,a=Array(l);f<l;)a[f]=arguments[f++];return arguments[f].apply(null,a)},G=/^/gm,B=function(f,l){return l.replace(G,f)+"\n"},F=function(){return Math.random().toString().substr(-7)},C,u,k,x,y;void function(){C=function(a){a.head=a.head||"";a.main=a.main||"";a.script=a.script||"";return a};u=function(a,b){switch(b&&b.constructor){case k:if(b._onCreate){var c=b._id;var d="("+b._onCreate+").call";c||(c="HTMxR"+F(),b.setAttribute("id",c),d='(function ( hel ) {\nhel.removeAttribute( "id" );\n'+d+"( hel );\n})");a.script+=d+'( document.getElementById( "'+c+'" ) );\n'}return c=a.main=b.elt();case x:a:{var f="";for(c in b){d=b[c];if("string"!==typeof d){c=null;break a}f+=d+"\n"}c=f}if(null==c)break;a.main=c;return b;case y:return c=a.main=b.point}a.main=null;throw Error(log.err(21,"htm_canNotCreateEltTag"));};k=function(a,b){this._isSingle=b;this._name=a;this._id=null;this._childs=this._dataset=this._attrs="";this._onCreate=null};k.prototype.setAttribute=function(a,b){"id"===a&&(this._id=b);this._attrs+=" "+a+'="'+b+'"'};var f=/([A-Z])/g;k.prototype.dataset=function(a){var b,c="";for(b in a){var d=a[b];c+=" data-"+b.replace(f,"-$1").toLowerCase()+'="'+("string"===typeof d?d:d.toString())+'"'}this._dataset=c};k.prototype.appendChild=function(a){var b;switch(a.constructor){case String:var c=B("    ",a);break;case x:for(b in c="",a){var d=a[b];if("string"!==typeof d){c=null;break}c+=B("    ",d)}}if(null!=c)this._childs+=c;else throw TypeError(log.err(21,"_typeError"));};k.prototype.onCreate=function(a){this._onCreate=a.toString()};k.prototype.elt=function(){var a,b=this._name;var c=""+("<"+b+this._attrs+this._dataset);this._isSingle?c+=" />":(c+=">",(a=this._childs)&&(c+="\n"+a),c+="</"+b+">");return c};x=function(a){for(var b,c=a.length;c--;)b=a[c],null!=b&&(this[c]=b)};var l=/^(?:([SN]{2})_)?([$_0-9A-Za-z]+)$/;y=function(a,b){var c=a.match(l);if(!c)throw Error(log.err(21,"htm_canNotPositioning"));var d="${ param."+c[2]+' || "'+(b||"")+'" }';switch(c[1]){case "NN":d="\n"+d+"\n";break;case "NS":d="\n"+d;break;case "SN":d+="\n"}this.point=d};y.prototype.replace=function(){}}();var D,E,v,A;void function(){function f(a){if("HYPERTEXT_getMarkHel"===a)return this;var e=a.split("*");var b=e[1]||null;e=new k(e[0]);var c=arguments,d=1,g=c[1],f=c.length;g&&g.constructor===Object&&(l(e,g),g=c[++d]);"function"===typeof g&&(e.onCreate(g),++d);for(;d<f;)g=c[d++],null!=g&&e.appendChild(g);e=u(this,e);b&&(this[b]=this.main);return e}function l(a,b){var e;for(e in b){var c=b[e];if(null!=c)switch(e){case "id":a.setAttribute("id",c);break;case "className":a.setAttribute("class",c);break;case "dataset":a.dataset(c);break;case "onCreate":a.onCreate(c);break;default:a.setAttribute(e,c)}}}v=function e(a){a=f.bind(C(a));a.singleTag=e.singleTag;a.loop=e.loop;a.nodeList=e.nodeList;a.pos=e.positioning;return a};v.singleTag=function(a,b){var c=new k(a,!0);b&&l(c,b);return u(this("HYPERTEXT_getMarkHel"),c)};v.loop=function(a,b){var c,e=this("HYPERTEXT_getMarkHel"),d=[];for(c in a)b(this,a[c],c,a),d.push(e.main);return u(e,new x(d))};v.nodeList=function(){var a=new x(arguments);return u(this("HYPERTEXT_getMarkHel"),a)};v.positioning=function(a,b){var c=new y(a,b);return u(this("HYPERTEXT_getMarkHel"),c)};D=function(a,b){"function"===typeof a&&(b=a,a={});b(v(a));return a.main};var a=!0;A=function(e){if(!e||e.constructor!==Object)return"";var d,f="";a=!1;for(d in e){var m=c("",d,e[d]);if(a)return"";f=f+(f&&m?b:"")+m}a=!0;return f};var b="\n",c=z("    ",";"+b,"}",/, ?/g,function(e,f,l,m){return function(g,r,t){if(!t||t.constructor!==Object)return a=!0,"";var k;g=d(g,r);var h="";r="";for(k in t){var n=t[k];if("string"===typeof n){var p=k;p=w.test(p)?p.replace(w,"-$1").toLowerCase():p;h+=e+p+": "+n+f}else{n=c(g,k,n);if(a)return"";r=r+(r&&n?b:"")+n}}h&&(b&&(g=g.replace(m,",\n")),h=g+" {"+b+h+l);return h+(h&&r?b:"")+r}}),d=z(/&/g,/>/g,/  +/g,/(^ | $)/g,function(a,b,c,d){return function(e,f){var g=f.replace(b," > ").replace(c," ").replace(d,"");return e?a.test(g)?g.replace(a,e):e+" "+g:g}}),w=/([A-Z])/g;E=function(a){switch(typeof a){case "object":var b=a;break;case "function":a(function(a){b=a})}a=new k("style");a.appendChild(A(b));return a.elt()}}();var w;void function(){function f(){h=0;p=n=null;q=""}function l(){3>h&&b();null==p&&y();var a=Function("title","param = {}","param.HTMLAYOUT_Title = title;return `"+q+"\n"+p+"\n    </body>\n</html>`;");a.markHel=n;f();return a}function a(){if(1<h)throw f(),Error(log.err(21,"htm_doubleCall","head"));1>h&&w();h=2;q+="\n    <head>";return a}function b(c){if(2<h)throw f(),Error(log.err(21,"htm_doubleCall","body"));2>h&&a();h=3;q+="\n    </head>\n    <body"+g(c)+">";return b}function c(a){m(this);q+="\n\n"+t("        ",D(n,a));return this}function d(a,b,c){m(this);b="\n"+("        <"+a+g(b)+">");c&&(b+="\n"+_matchpositioning(t("            ",c)));q+=b+("        </"+a+">");return this}function u(a,b){m(this);q+="\n        <"+a+g(b)+" />";return this}function v(a){m(this);q+="\n\n"+r(a);return this}function e(a){m(this);q+="\n        \x3c!--\n"+r(t("            ",a))+"         --\x3e";return this}function x(a){m(this);q+="\n\n"+t("        ",E(a));return this}function y(a){m(this);var b="",c=n.script;p="";var d="HTMxEndxR"+z(),e=new k("script");e.setAttribute("id",d);a&&(e.onCreate(a),b="("+e._onCreate+")();\n");e.appendChild(c+b+'${ ( param.endScript || "" ) && "(" + param.endScript.toString() + ")();" }\ndocument.getElementById( "'+d+'" ).remove();');p="\n"+t("        ",e.elt());return this}function m(c){switch(c){case a:2>h&&c();break;case b:3>h&&c()}}function g(a){if(!a)return"";var b,c="";for(b in a)c+=" "+b+'="'+r(a[b])+'"';return c}function r(a){return a.replace(A,function(a,b,c){a="${ param."+c+' || "" }';switch(b){case "NN":a="\n"+a+"\n";break;case "NS":a="\n"+a;break;case "SN":a+="\n"}return a})}var t=B,z=F,h=0,n=null,p=null,q="";w=function H(a,b){h=1;1>=arguments.length&&(b=a,a="<!DOCTYPE html>");n=C({});p=null;q=a+"\n<html"+g(b)+">";return H};w.head=a;a.mth=l;a.body=b;a.child=c;a.title=function(){m(this);q+='\n        <title>${ param.HTMLAYOUT_Title || "" }</title>';return this};a.meta=function(a){return this.singleTag("meta",a)};a.tag=d;a.singleTag=u;a.style=x;a.txt=v;a.comment=e;b.mth=l;b.child=c;b.endScript=y;b.tag=d;b.singleTag=u;b.style=x;b.txt=v;b.comment=e;var A=/\{\{(?:([SN]{2})_)?([$_0-9A-Za-z]+)\}\}/g}();w.tag=D;w.tagStyle=E;return w}();
